{% extends "layout.html" %}

{% block content %}
<style>
    /* UI Fixes for Search Bar & Grid */
    .hero-box { text-align: center; margin-top: 40px; }
    .hero-title { font-size: 38px; font-weight: 800; color: #0f172a; margin-bottom: 10px; }
    
    .search-wrap { 
        background: white; border: 2px solid #e2e8f0; padding: 6px; border-radius: 12px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.05); display: flex; align-items: center; 
        max-width: 700px; margin: 0 auto; 
    }
    .search-wrap input { flex: 1; border: none; padding: 12px 20px; font-size: 16px; outline: none; }
    
    .res-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 25px; margin-top: 50px; text-align: left; }
    .res-card { background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 25px; }
    
    .meta-item { display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; padding: 10px 0; font-size: 13px; }
    .skill-tag { background: #eef2ff; color: #4f46e5; padding: 5px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; display: inline-block; margin: 3px; }
</style>

<div class="hero-box">
    <div style="width: 60px; height: 60px; background: #eff6ff; color: #3b82f6; border-radius: 16px; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
        <i class="fa-solid fa-rocket"></i>
    </div>
    <h1 class="hero-title">Research Application <span style="color: #6366f1;">Optimizer</span></h1>
    <p style="color:#64748b; font-size:18px; margin-bottom:40px;">Turn complex research papers into hyper-personalized internship applications.</p>

    <div class="search-wrap">
        <span style="padding-left: 15px; color: #94a3b8;"><i class="fa-solid fa-link"></i></span>
        <input type="text" id="paperUrl" placeholder="Paste Research Paper Link (arXiv, Semantic Scholar)...">
        <button onclick="runOptimizer()" class="btn-black" style="padding: 12px 25px; border-radius: 8px; cursor: pointer;">
            <i class="fa-solid fa-wand-magic-sparkles"></i> Optimize
        </button>
    </div>
</div>

<div id="result-area" class="res-grid" style="display:none;">
    
    <div class="res-card">
        <h3 style="margin-bottom:15px; font-size:18px; color:#0f172a;"><i class="fa-solid fa-file-pen"></i> Generated Draft</h3>
        <textarea id="app-text" style="width:100%; height:400px; padding:15px; border-radius:8px; border:1px solid #e2e8f0; font-family:inherit; color:#334155; font-size:14px; line-height:1.6; resize:none; outline:none;"></textarea>
    </div>

    <div style="display:flex; flex-direction:column; gap:20px;">
        
        <div class="res-card" style="padding: 20px;">
            <div class="meta-item"><span style="color:#64748b; font-weight:600;">Citation Score</span><span id="cit-score" style="color:#0f172a; font-weight:700;">-</span></div>
            <div class="meta-item"><span style="color:#64748b; font-weight:600;">Vacancies</span><span id="vacancies" style="color:#0f172a; font-weight:700;">-</span></div>
            <div class="meta-item" style="border:none;"><span style="color:#64748b; font-weight:600;">Applicants</span><span id="applicants" style="color:#0f172a; font-weight:700;">-</span></div>
        </div>

        <div class="res-card">
            <h4 style="margin-bottom:10px; font-size:14px;">ðŸ“„ Paper Summary</h4>
            <p id="paper-summary" style="font-size:13px; color:#64748b; line-height:1.6;">...</p>
        </div>

        <div class="res-card">
            <h4 style="margin-bottom:10px; font-size:14px;">âš¡ Required Skills</h4>
            <div id="skills-container"></div>
        </div>
        
        <button onclick="submitApp()" id="btn-apply" style="width:100%; background:#16a34a; color:white; padding:15px; border-radius:8px; border:none; font-weight:600; cursor:pointer; font-size:15px;">
            Apply Now <i class="fa-solid fa-arrow-right"></i>
        </button>
    </div>
</div>

<script>
    async function runOptimizer() {
        const btn = document.querySelector('.btn-black');
        const resultArea = document.getElementById('result-area');
        
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';
        resultArea.style.display = 'none';

        try {
            const url = document.getElementById('paperUrl').value;
            const response = await fetch('/optimize', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({url: url})
            });
            const data = await response.json();
            
            // FILL DATA
            document.getElementById('app-text').value = data.application;
            document.getElementById('cit-score').innerText = data.analysis.citation_score;
            document.getElementById('vacancies').innerText = data.analysis.vacancies;
            document.getElementById('applicants').innerText = data.analysis.applicants;
            document.getElementById('paper-summary').innerText = data.analysis.summary;
            
            const skillsDiv = document.getElementById('skills-container');
            skillsDiv.innerHTML = '';
            data.analysis.skills.forEach(skill => {
                skillsDiv.innerHTML += `<span class="skill-tag">${skill}</span>`;
            });

            resultArea.style.display = 'grid';
            btn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Optimize';
            
        } catch (error) {
            console.error(error);
            alert("Error fetching data. Check console.");
            btn.innerHTML = 'Retry';
        }
    }

    function submitApp() {
        alert("Success! Your application has been emailed to the Professor.");
    }
</script>
{% endblock %}